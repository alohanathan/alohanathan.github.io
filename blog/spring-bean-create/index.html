<!doctype html><html lang=zh><head><meta name=viewport content="width=device-width,initial-scale=1"><title>Spring源码阅读（一）Bean的创建过程</title><meta charset=utf-8><meta name=description content="Ladder@Spring源码阅读（一）Bean的创建过程 - 逃跑山羊生活志"><meta name=author content="逃跑山羊"><link rel=canonical href=https://www.hinathan.online/blog/spring-bean-create/><meta name=google-site-verification content="xxx"><link rel=alternate type=application/rss+xml href=https://www.hinathan.online/index.xml title=逃跑山羊生活志><script async src="https://www.googletagmanager.com/gtag/js?id=G-Y3KQB3PB19"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Y3KQB3PB19",{anonymize_ip:!1})}</script><meta property="og:title" content="Spring源码阅读（一）Bean的创建过程"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://www.hinathan.online/blog/spring-bean-create/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-04-16T13:20:16+08:00"><meta property="article:modified_time" content="2025-04-16T13:20:16+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Spring源码阅读（一）Bean的创建过程"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Blogs","item":"https://www.hinathan.online/blog/"},{"@type":"ListItem","position":3,"name":"Spring源码阅读（一）Bean的创建过程","item":"https://www.hinathan.online/blog/spring-bean-create/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Spring源码阅读（一）Bean的创建过程","name":"Spring源码阅读（一）Bean的创建过程","description":"","keywords":["Spring"],"articleBody":"实例化 -\u003e 属性填充 -\u003e BeanPostProcessor前置处理 -\u003e 初始化阶段 -\u003e BeanPostProcessor后置处理 -\u003e 初始化完成 -\u003e PostConstruct -\u003e InitializingBean.afterPropertiesSet -\u003e 自定义init-method -\u003e AOP\n创建的大致流程 推断构造方法 利用该类的构造方法来实例化得到一个对象（但是如何一个类中有多个构造方法，Spring则会进行选择，这个叫做推断构造方法）\n依赖注入 得到一个对象后，Spring会判断该对象中是否存在被@Autowired注解了的属性，把这些属性找出来并由Spring进行赋值（属性填充）\nBeanPostProcessor处理和初始化 依赖注入后，Spring会判断该对象是否实现了BeanNameAware接口、BeanClassLoaderAware接口、BeanFactoryAware接口，如果实现了，就表示当前对象必须实现该接口中所定义的setBeanName()、setBeanClassLoader()、setBeanFactory()方法，那Spring就会调用这些方法并传入相应的参数（Aware回调）\nPostConstruct 处理 Aware回调后，Spring会判断该对象中是否存在某个方法被@PostConstruct注解了，如果存在，Spring会调用当前对象的此方法（初始化前）\nInitializingBean.afterPropertiesSet 紧接着，Spring会判断该对象是否实现了InitializingBean接口，如果实现了，就表示当前对象必须实现该接口中的afterPropertiesSet()方法，那Spring就会调用当前对象中的afterPropertiesSet()方法（初始化）\n自定义init-method 执行自定义init-method\nAOP 最后，Spring会判断当前对象需不需要进行AOP，如果不需要那么Bean就创建完了，如果需要进行AOP，则会进行动态代理并生成一个代理对象做为Bean（初始化后）\n我们可以发现，当Spring根据UserService类来创建一个Bean时：\n如果不用进行AOP，那么Bean就是UserService类的构造方法所得到的对象。 如果需要进行AOP，那么Bean就是UserService的代理类所实例化得到的对象，而不是UserService本身所得到的对象。 Bean对象创建出来后：\n如果当前Bean是单例Bean，那么会把该Bean对象存入一个Map，Map的key为beanName，value为Bean对象。这样下次getBean时就可以直接从Map中拿到对应的Bean对象了。（实际上，在Spring源码中，这个Map就是单例池） 如果当前Bean是原型Bean，那么后续没有其他动作，不会存入一个Map，下次getBean时会再次执行上述创建过程，得到一个新的Bean对象。 初始化入口 AbstractAutowireCapableBeanFactory\n// 源码路径：org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory protected Object initializeBean(String beanName, Object bean, @Nullable RootBeanDefinition mbd) { // 调用Aware接口方法 invokeAwareMethods(beanName, bean); Object wrappedBean = bean; if (mbd == null || !mbd.isSynthetic()) { // 执行BeanPostProcessor前置处理（包括@PostConstruct注入） wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName); } try { // 执行InitializingBean和init-method invokeInitMethods(beanName, wrappedBean, mbd); } catch (Throwable ex) { throw new BeanCreationException(); } if (mbd == null || !mbd.isSynthetic()) { // 执行BeanPostProcessor后置处理 wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName); } return wrappedBean; } @PostConstruct 处理机制 InitDestroyAnnotationBeanPostProcessor\n// 源码关键路径：org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException { // 获取@PostConstruct元数据 LifecycleMetadata metadata = findLifecycleMetadata(bean.getClass()); try { // 反射执行初始化方法 metadata.invokeInitMethods(bean, beanName); } catch (Throwable ex) { throw new BeanCreationException(); } return bean; } InitializingBean 处理机制 // 源码路径：org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory protected void invokeInitMethods(String beanName, Object bean, @Nullable RootBeanDefinition mbd) throws Throwable { if (bean instanceof InitializingBean) { // 执行接口方法 ((InitializingBean) bean).afterPropertiesSet(); } if (mbd != null \u0026\u0026 bean.getClass() != NullBean.class) { String initMethodName = mbd.getInitMethodName(); if (StringUtils.hasLength(initMethodName)) { // 反射调用自定义init方法 invokeCustomInitMethod(beanName, bean, mbd); } } } 执行顺序与线程安全 BeanPostProcessor.postProcessBeforeInitialization -\u003e PostConstruct -\u003e InitializingBean.afterPropertiesSet -\u003e 自定义init-method -\u003e BeanPostProcessor.postProcessAfterInitialization\n核心类 InitDestroyAnnotationBeanPostProcessor\npostProcessBeforeInitialization() findLifecycleMetadata() AbstractAutowireCapableBeanFactory\ninvokeInitMethods() invokeCustomInitMethod() CommonAnnotationBeanPostProcessor\npostProcessBeforeInitialization() @PostConstruct 和 InitializingBean @PostConstruct 和 InitializingBean 在 Spring 生命周期中扮演着不同的角色：\n@PostConstruct 基于标准注解的轻量级初始化 通过BeanPostProcessor实现 支持方法级细粒度控制 InitializingBean 框架原生接口方案 直接集成到Bean初始化流程 提供类型安全的回调 生产环境选择建议 80%场景使用@PostConstruct 需要强制初始化保障时选择InitializingBean 第三方库集成使用init-method ","wordCount":"1927","inLanguage":"zh","datePublished":"2025-04-16T13:20:16+08:00","dateModified":"2025-04-16T13:20:16+08:00","author":{"@type":"Person","name":"逃跑山羊"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.hinathan.online/blog/spring-bean-create/"},"publisher":{"@type":"Organization","name":"逃跑山羊生活志","logo":{"@type":"ImageObject","url":"https://www.hinathan.online/favicon.ico"}}}</script><link rel=icon href=/favicon.icon sizes=16x16><link rel=apple-touch-icon href=/favicon.icon><link rel=manifest href=/favicon.icon><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.7.0/style.css><link rel=stylesheet href=/css/main.min.e4397cb14af48e0d175e9e854177b50c687a81aaa505e7ec7c948717cea895bd.css integrity="sha256-5Dl8sUr0jg0XXp6FQXe1DGh6gaqlBefsfJSHF86olb0=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.872dfd2cd00064018a833a6e8e77a0fbf8fbac159546f2f205d4dad79a5d8e15.js></script>
<script>hljs.highlightAll()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>主页</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/blog>学习杂记</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/art>山羊日记</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/story>故事汇</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/series>系列</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives>历史文章</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/tags>标签</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/guestbook>留言板</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/alohanathan><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://www.instagram.com/alohanathan59><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-instagram"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1112.63 8 4 4 0 0116 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg></a></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>Spring源码阅读（一）Bean的创建过程</h1></header><p><small>2025年4月16日&nbsp;· 1927 字&nbsp;· 4 分钟</small>
<small>·
<a href=https://www.hinathan.online/tags/spring/>Spring</a></small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#创建的大致流程>创建的大致流程</a><ul><li><a href=#推断构造方法>推断构造方法</a></li><li><a href=#依赖注入>依赖注入</a></li><li><a href=#beanpostprocessor处理和初始化>BeanPostProcessor处理和初始化</a></li><li><a href=#postconstruct-处理>PostConstruct 处理</a></li><li><a href=#initializingbeanafterpropertiesset>InitializingBean.afterPropertiesSet</a></li><li><a href=#自定义init-method>自定义init-method</a></li><li><a href=#aop>AOP</a></li></ul></li><li><a href=#初始化入口>初始化入口</a></li><li><a href=#postconstruct-处理机制>@PostConstruct 处理机制</a></li><li><a href=#initializingbean-处理机制>InitializingBean 处理机制</a></li><li><a href=#执行顺序与线程安全>执行顺序与线程安全</a></li><li><a href=#核心类>核心类</a></li><li><a href=#postconstruct-和-initializingbean>@PostConstruct 和 InitializingBean</a><ul><li><a href=#postconstruct>@PostConstruct</a></li><li><a href=#initializingbean>InitializingBean</a></li><li><a href=#生产环境选择建议>生产环境选择建议</a></li></ul></li></ul></nav></div><section class=blog-content><p>实例化 -> 属性填充 -> BeanPostProcessor前置处理 -> 初始化阶段 -> BeanPostProcessor后置处理 -> 初始化完成 -> PostConstruct -> InitializingBean.afterPropertiesSet -> 自定义init-method -> AOP</p><h2 id=创建的大致流程>创建的大致流程</h2><h3 id=推断构造方法>推断构造方法</h3><p>利用该类的构造方法来实例化得到一个对象（但是如何一个类中有多个构造方法，Spring则会进行选择，这个叫做推断构造方法）</p><h3 id=依赖注入>依赖注入</h3><p>得到一个对象后，Spring会判断该对象中是否存在被@Autowired注解了的属性，把这些属性找出来并由Spring进行赋值（属性填充）</p><h3 id=beanpostprocessor处理和初始化>BeanPostProcessor处理和初始化</h3><p>依赖注入后，Spring会判断该对象是否实现了<code>BeanNameAware</code>接口、<code>BeanClassLoaderAware</code>接口、<code>BeanFactoryAware</code>接口，如果实现了，就表示当前对象必须实现该接口中所定义的<code>setBeanName()</code>、<code>setBeanClassLoader()</code>、<code>setBeanFactory()</code>方法，那Spring就会调用这些方法并传入相应的参数（Aware回调）</p><h3 id=postconstruct-处理>PostConstruct 处理</h3><p>Aware回调后，Spring会判断该对象中是否存在某个方法被@PostConstruct注解了，如果存在，Spring会调用当前对象的此方法（初始化前）</p><h3 id=initializingbeanafterpropertiesset>InitializingBean.afterPropertiesSet</h3><p>紧接着，Spring会判断该对象是否实现了InitializingBean接口，如果实现了，就表示当前对象必须实现该接口中的afterPropertiesSet()方法，那Spring就会调用当前对象中的afterPropertiesSet()方法（初始化）</p><h3 id=自定义init-method>自定义init-method</h3><p>执行自定义init-method</p><h3 id=aop>AOP</h3><p>最后，Spring会判断当前对象需不需要进行AOP，如果不需要那么Bean就创建完了，如果需要进行AOP，则会进行动态代理并生成一个代理对象做为Bean（初始化后）</p><p>我们可以发现，当Spring根据UserService类来创建一个Bean时：</p><ol><li>如果不用进行AOP，那么Bean就是UserService类的构造方法所得到的对象。</li><li>如果需要进行AOP，那么Bean就是UserService的代理类所实例化得到的对象，而不是UserService本身所得到的对象。</li></ol><p>Bean对象创建出来后：</p><ol><li>如果当前Bean是单例Bean，那么会把该Bean对象存入一个Map&lt;String, Object>，Map的key为beanName，value为Bean对象。这样下次getBean时就可以直接从Map中拿到对应的Bean对象了。（实际上，在Spring源码中，这个Map就是单例池）</li><li>如果当前Bean是原型Bean，那么后续没有其他动作，不会存入一个Map，下次getBean时会再次执行上述创建过程，得到一个新的Bean对象。</li></ol><h2 id=初始化入口>初始化入口</h2><p><code>AbstractAutowireCapableBeanFactory</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 源码路径：org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>protected</span> Object <span style=color:#a6e22e>initializeBean</span><span style=color:#f92672>(</span>String beanName<span style=color:#f92672>,</span> Object bean<span style=color:#f92672>,</span> <span style=color:#a6e22e>@Nullable</span> RootBeanDefinition mbd<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 调用Aware接口方法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    invokeAwareMethods<span style=color:#f92672>(</span>beanName<span style=color:#f92672>,</span> bean<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Object wrappedBean <span style=color:#f92672>=</span> bean<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mbd <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>||</span> <span style=color:#f92672>!</span>mbd<span style=color:#f92672>.</span><span style=color:#a6e22e>isSynthetic</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 执行BeanPostProcessor前置处理（包括@PostConstruct注入）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        wrappedBean <span style=color:#f92672>=</span> applyBeanPostProcessorsBeforeInitialization<span style=color:#f92672>(</span>wrappedBean<span style=color:#f92672>,</span> beanName<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 执行InitializingBean和init-method
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        invokeInitMethods<span style=color:#f92672>(</span>beanName<span style=color:#f92672>,</span> wrappedBean<span style=color:#f92672>,</span> mbd<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Throwable ex<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> BeanCreationException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mbd <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>||</span> <span style=color:#f92672>!</span>mbd<span style=color:#f92672>.</span><span style=color:#a6e22e>isSynthetic</span><span style=color:#f92672>())</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 执行BeanPostProcessor后置处理
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        wrappedBean <span style=color:#f92672>=</span> applyBeanPostProcessorsAfterInitialization<span style=color:#f92672>(</span>wrappedBean<span style=color:#f92672>,</span> beanName<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> wrappedBean<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=postconstruct-处理机制>@PostConstruct 处理机制</h2><p>InitDestroyAnnotationBeanPostProcessor</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 源码关键路径：org.springframework.beans.factory.annotation.InitDestroyAnnotationBeanPostProcessor
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> Object <span style=color:#a6e22e>postProcessBeforeInitialization</span><span style=color:#f92672>(</span>Object bean<span style=color:#f92672>,</span> String beanName<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> BeansException <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 获取@PostConstruct元数据
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    LifecycleMetadata metadata <span style=color:#f92672>=</span> findLifecycleMetadata<span style=color:#f92672>(</span>bean<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 反射执行初始化方法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        metadata<span style=color:#f92672>.</span><span style=color:#a6e22e>invokeInitMethods</span><span style=color:#f92672>(</span>bean<span style=color:#f92672>,</span> beanName<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Throwable ex<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> BeanCreationException<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> bean<span style=color:#f92672>;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=initializingbean-处理机制>InitializingBean 处理机制</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#75715e>// 源码路径：org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>protected</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>invokeInitMethods</span><span style=color:#f92672>(</span>String beanName<span style=color:#f92672>,</span> Object bean<span style=color:#f92672>,</span> <span style=color:#a6e22e>@Nullable</span> RootBeanDefinition mbd<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throws</span> Throwable <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>bean <span style=color:#66d9ef>instanceof</span> InitializingBean<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 执行接口方法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#f92672>((</span>InitializingBean<span style=color:#f92672>)</span> bean<span style=color:#f92672>).</span><span style=color:#a6e22e>afterPropertiesSet</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>mbd <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span> bean<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> NullBean<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        String initMethodName <span style=color:#f92672>=</span> mbd<span style=color:#f92672>.</span><span style=color:#a6e22e>getInitMethodName</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>StringUtils<span style=color:#f92672>.</span><span style=color:#a6e22e>hasLength</span><span style=color:#f92672>(</span>initMethodName<span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 反射调用自定义init方法
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            invokeCustomInitMethod<span style=color:#f92672>(</span>beanName<span style=color:#f92672>,</span> bean<span style=color:#f92672>,</span> mbd<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=执行顺序与线程安全>执行顺序与线程安全</h2><p>BeanPostProcessor.postProcessBeforeInitialization -> PostConstruct -> InitializingBean.afterPropertiesSet -> 自定义init-method -> BeanPostProcessor.postProcessAfterInitialization</p><h2 id=核心类>核心类</h2><ul><li><p>InitDestroyAnnotationBeanPostProcessor</p><ul><li>postProcessBeforeInitialization()</li><li>findLifecycleMetadata()</li></ul></li><li><p>AbstractAutowireCapableBeanFactory</p><ul><li>invokeInitMethods()</li><li>invokeCustomInitMethod()</li></ul></li><li><p>CommonAnnotationBeanPostProcessor</p><ul><li>postProcessBeforeInitialization()</li></ul></li></ul><h2 id=postconstruct-和-initializingbean>@PostConstruct 和 InitializingBean</h2><p>@PostConstruct 和 InitializingBean 在 Spring 生命周期中扮演着不同的角色：</p><h3 id=postconstruct>@PostConstruct</h3><ul><li>基于标准注解的轻量级初始化</li><li>通过BeanPostProcessor实现</li><li>支持方法级细粒度控制</li></ul><h3 id=initializingbean>InitializingBean</h3><ul><li>框架原生接口方案</li><li>直接集成到Bean初始化流程</li><li>提供类型安全的回调</li></ul><h3 id=生产环境选择建议>生产环境选择建议</h3><ul><li>80%场景使用@PostConstruct</li><li>需要强制初始化保障时选择InitializingBean</li><li>第三方库集成使用init-method</li></ul></section><div class=related-resources></div><div class=comments><script>const getTheme=window.localStorage&&window.localStorage.getItem("theme");let theme=getTheme==="dark"?"dark":"light",s=document.createElement("script");s.src="https://giscus.app/client.js",s.setAttribute("data-repo","alohanathan/alohanathan.github.io"),s.setAttribute("data-repo-id","R_kgDON4MTgw"),s.setAttribute("data-category","Announcements"),s.setAttribute("data-category-id","DIC_kwDON4MTg84Cocaw"),s.setAttribute("data-mapping","pathname"),s.setAttribute("data-strict","0"),s.setAttribute("data-reactions-enabled","1"),s.setAttribute("data-emit-metadata","0"),s.setAttribute("data-input-position","top"),s.setAttribute("data-theme",theme),s.setAttribute("data-lang","zh-CN"),s.setAttribute("data-loading","lazy"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></article></div><footer class=footer><p>&copy; 2025 <a href=https://www.hinathan.online>逃跑山羊生活志</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg></a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e.js integrity="sha512-z4PhNX7vuL3xVChQ1m2AB9Yg5AULVxXcg/SpIdNs6c5H0NE8XYXysP+DGNKHfuwvY7kxvUdBeoGlODJ6+SfaPg==" crossorigin=anonymous defer></script></html>